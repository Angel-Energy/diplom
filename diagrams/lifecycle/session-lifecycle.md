# –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ü—Ä–æ–µ–∫—Ç: "–°–æ–æ–±—â–µ–Ω–∏–µ 404"

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 26 –∏—é–Ω—è 2025, 10:15 AM CEST  
–í–µ—Ä—Å–∏—è: 1.0  
–°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

---

## üìã –û–ë–ó–û–† –î–ò–ê–ì–†–ê–ú–ú–´

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –≤ –∏–≥—Ä–µ "–°–æ–æ–±—â–µ–Ω–∏–µ 404" —Å —É—á–µ—Ç–æ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞: –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã, –ª–æ–∫–∞–ª—å–Ω—ã–π Ktor-—Å–µ—Ä–≤–µ—Ä, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó, —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –û—Ñ–ª–∞–π–Ω-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Room Database
- –õ–æ–∫–∞–ª—å–Ω—ã–π Ktor-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ —Å–µ—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó —á–µ—Ä–µ–∑ AES-256 —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π UI –ø–∞—Ç—Ç–µ—Ä–Ω
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WorkManager

---

## üîÑ –°–•–ï–ú–ê –ñ–ò–ó–ù–ï–ù–ù–û–ì–û –¶–ò–ö–õ–ê

### PlantUML –¥–∏–∞–≥—Ä–∞–º–º–∞
```plantuml
@startuml Session Lifecycle - Message 404
!theme plain
skinparam backgroundColor #1e1e2e
skinparam defaultTextColor #cdd6f4
skinparam activityBackgroundColor #313244
skinparam activityBorderColor #585b70

title –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - "–°–æ–æ–±—â–µ–Ω–∏–µ 404"

start

:–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
note right: Cold/Warm start
note right: Theme: Dark Mode

:–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏;
if (–°–µ—Å—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?) then (–¥–∞)
  :–í–∞–ª–∏–¥–∞—Ü–∏—è PIN;
  if (PIN –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π?) then (–¥–∞)
    :–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
    note right: AES-256 —Å Android Keystore
    note right: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó
  else (–Ω–µ—Ç)
    :–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞;
    note right: –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    stop
  endif
else (–Ω–µ—Ç)
  :–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏;
  :–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PIN;
  :–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è;
endif

:–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GameEngine;
note right: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Room Database
note right: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ñ–ª–∞–π–Ω-–¥–∞–Ω–Ω—ã—Ö

:–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è;
if (Ktor-—Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω?) then (–¥–∞)
  :–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º;
  note right: –°–µ—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  note right: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
else (–Ω–µ—Ç)
  :–†–µ–∂–∏–º –æ—Ñ–ª–∞–π–Ω;
  note right: –í—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞
endif

partition "–ê–∫—Ç–∏–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è —Å–µ—Å—Å–∏—è" {
  :–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è;
  
  repeat
    :–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞;
    note right: Jetpack Compose UI
    note right: –¢—ë–º–Ω–∞—è —Ç–µ–º–∞
    
    :–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
    
    switch (–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è?)
    case (–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è)
      :–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ ChatViewModel;
      :–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Room;
    case (–í—ã–±–æ—Ä –¥–∏–∞–ª–æ–≥–∞)
      :–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è;
      :–ü–µ—Ä–µ—Å—á—ë—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (trust/threat);
    case (–ú–∏–Ω–∏-–∏–≥—Ä–∞)
      :–ó–∞–ø—É—Å–∫ MinigameActivity;
      :–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤;
    case (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)
      :–ü–µ—Ä–µ—Ö–æ–¥ –≤ SettingsScreen;
    endswitch
    
    :–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞;
    note right: –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    note right: WorkManager background task
    
    if (–°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ?) then (–¥–∞)
      :–§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è;
      note right: Ktor Client –≤ –∫–æ—Ä—É—Ç–∏–Ω–µ
    endif
    
  repeat while (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω?)
}

:–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏;
note right: –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–∞

:–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ;
:–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö;
if (–°–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞?) then (–¥–∞)
  :–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º;
endif

:–û—á–∏—Å—Ç–∫–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏;
:–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π;

stop

@enduml
```

### Mermaid –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
```mermaid
flowchart TD
    A[–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è] --> B{–°–µ—Å—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?}
    
    B -->|–î–∞| C[–í–∞–ª–∏–¥–∞—Ü–∏—è PIN]
    B -->|–ù–µ—Ç| D[–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏]
    
    C --> E{PIN –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π?}
    E -->|–î–∞| F[–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö]
    E -->|–ù–µ—Ç| G[–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞]
    
    D --> H[–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PIN]
    H --> I[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π]
    
    F --> J[–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GameEngine]
    I --> J
    
    J --> K{Ktor-—Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω?}
    K -->|–î–∞| L[–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è]
    K -->|–ù–µ—Ç| M[–†–µ–∂–∏–º –æ—Ñ–ª–∞–π–Ω]
    
    L --> N[–ê–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è]
    M --> N
    
    N --> O[–ß–∞—Ç-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å]
    O --> P{–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è}
    
    P -->|–°–æ–æ–±—â–µ–Ω–∏–µ| Q[ChatViewModel]
    P -->|–î–∏–∞–ª–æ–≥| R[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è]
    P -->|–ú–∏–Ω–∏-–∏–≥—Ä–∞| S[MinigameActivity]
    P -->|–ù–∞—Å—Ç—Ä–æ–π–∫–∏| T[SettingsScreen]
    
    Q --> U[–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ]
    R --> U
    S --> U
    T --> U
    
    U --> V{–°–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞?}
    V -->|–î–∞| W[–§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è]
    V -->|–ù–µ—Ç| X[–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ]
    
    W --> Y{–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω?}
    X --> Y
    
    Y -->|–î–∞| O
    Y -->|–ù–µ—Ç| Z[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏]
    
    Z --> AA[–§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ]
    AA --> BB[–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö]
    BB --> CC[–û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏]
    CC --> DD[–ö–æ–Ω–µ—Ü]
    
    style A fill:#2d3748,stroke:#4a5568,color:#e2e8f0
    style N fill:#2b6cb0,stroke:#3182ce,color:#e2e8f0
    style Z fill:#c53030,stroke:#e53e3e,color:#e2e8f0
```

---

## üíª –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### SessionManager
```kotlin
@Singleton
class SessionManager @Inject constructor(
    private val encryptionService: EncryptionService,
    private val gameStateRepository: GameStateRepository,
    private val syncManager: OfflineSyncManager,
    private val authManager: AuthManager
) {
    // ... (—Å–º. –ø–æ–¥—Ä–æ–±–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã—à–µ)
}
```

#### SessionState
```kotlin
sealed class SessionState {
    object Uninitialized : SessionState()
    object Authenticating : SessionState()
    data class Active(
        val sessionId: String,
        val gameState: GameState,
        val startTime: Long
    ) : SessionState()
    object Ended : SessionState()
}
```

#### SessionResult
```kotlin
sealed class SessionResult {
    object Success : SessionResult()
    object AuthenticationFailed : SessionResult()
    data class Error(val message: String) : SessionResult()
}
```

#### AuthManager (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó)
```kotlin
@Singleton
class AuthManager @Inject constructor(
    private val encryptionService: EncryptionService,
    private val secureStorage: SecureStorageManager,
    private val biometricManager: BiometricManager
) {
    // ... (—Å–º. –ø–æ–¥—Ä–æ–±–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—ã—à–µ)
}
```

---

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–º–∞–Ω–¥–æ–π
- Android-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (Kotlin): —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —Å–µ—Å—Å–∏–∏, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.
- Backend-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: —Ä–µ–∞–ª–∏–∑—É–µ—Ç Ktor-—Å–µ—Ä–≤–µ—Ä –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é.
- QA-–∞–Ω–∞–ª–∏—Ç–∏–∫: —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—Ö–æ–¥–∞, –≤—ã—Ö–æ–¥–∞, –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞.
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å: –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª.

## –ö–æ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç
- –î–ª—è Android-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, backend-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, QA –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–∏—Å–∞—Ç–µ–ª–µ–π.

## –ê—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã
- –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ñ–ª–∞–π–Ω/–æ–Ω–ª–∞–π–Ω —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
- –í–∞–∂–Ω–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó.
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —Å—Ö–µ–º—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞. 